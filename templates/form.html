<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generatore Referti Radiologici</title>
    <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
    <header>
        <h1>Generatore di Referti Radiologici</h1>
        <div class="disclaimer">Questo software non sostituisce il giudizio medico. Non inserire dati identificativi. Il contenuto è generato con supporto AI.</div>
    </header>

    <main>
        {% if error_message %}
        <div style="background-color: #ffebee; color: #c62828; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; border: 1px solid #ef9a9a;">
            <strong>Errore:</strong> {{ error_message }}
        </div>
        {% endif %}

        <section class="form-section">
            <form method="post" action="/generate">
                <div class="grid">
                    <label class="full">
                        Protocollo
                        <select name="protocol" required>
                            <option value="shoulder">Ecografia ed infiltrazione Spalla</option>
                            <option value="achilles">Infiltrazione ecoguidata tendine Achille</option>
                            <option value="generic">Generico</option>
                        </select>
                    </label>
                    <label class="full">
                        Prescrittore
                        <select name="prescriber" required>
                            <option value="tosca">Dr. Enrico Tosca (Ponte Tresa)</option>
                            <option value="mantini">Dr. Vito Mantini (Lamone)</option>
                            <option value="generic">Generico</option>
                        </select>
                    </label>
                    <label>
                        Nome Paziente
                        <input type="text" name="patient_name" value="{{ patient_name or '' }}" required />
                    </label>
                    <label>
                        Data di Nascita
                        <input type="text" name="patient_dob" placeholder="GG.MM.AAAA" value="{{ patient_dob or '' }}" required />
                    </label>
                    <label>
                        Lato
                        <select name="side">
                            <option value="destra">Destra</option>
                            <option value="sinistra">Sinistra</option>
                            <option value="bilaterale">Bilaterale</option>
                        </select>
                    </label>
                    <label>
                        Data Esame (Auto: Oggi)
                        <input type="text" name="exam_date" value="10.12.2025" readonly />
                    </label>
                    <label class="full">
                        Indicazioni Cliniche
                        <textarea name="indications" rows="3" placeholder="Es. Trauma, dolore notturno..." required>{{ indications or '' }}</textarea>
                    </label>
                    <label class="full">
                        Reperti Ecografici
                        <textarea name="findings" rows="6" placeholder="Descrivi borsa, tendini, versamento..." required>{{ findings or '' }}</textarea>
                    </label>
                    
                    <!-- Campi nascosti per compatibilità futura -->
                    <input type="hidden" name="exam_type" value="ECO" />
                    
                </div>
                <button type="submit" class="primary">Genera Referto Word</button>
            </form>
        </section>

        {% if message %}
        <section class="result-section">
            <h2>Conferma</h2>
            <p>{{ message }}</p>
        </section>
        {% endif %}

        {% if report_text %}
        <section class="preview-section">
            <h2>Anteprima referto</h2>
            <pre>{{ report_text }}</pre>
        </section>
        {% endif %}
    </main>

    <footer>
        <div class="disclaimer">Questo software non sostituisce il giudizio medico. Non inserire dati identificativi. Il contenuto è generato con supporto AI.</div>
    </footer>
</body>
</html>